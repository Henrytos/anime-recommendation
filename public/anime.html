<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="./assets/styles/anime.css">
    <link rel="shortcut icon" href="./assets/icons/logo.png" type="image/x-icon">
</head>

<body>
    <section class="start container">
        <nav class="nav-bar">
            <a href="./index.html">
                <img src="./assets/images/logo-home.png" id="logo" alt="logo" width="292" height="64">
            </a>
            <div class="buttons">
                <button class="button button-foreground icon" id="button_theme">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-sun-moon-icon lucide-sun-moon">
                        <path d="M12 8a2.83 2.83 0 0 0 4 4 4 4 0 1 1-4-4" />
                        <path d="M12 2v2" />
                        <path d="M12 20v2" />
                        <path d="m4.9 4.9 1.4 1.4" />
                        <path d="m17.7 17.7 1.4 1.4" />
                        <path d="M2 12h2" />
                        <path d="M20 12h2" />
                        <path d="m6.3 17.7-1.4 1.4" />
                        <path d="m19.1 4.9-1.4 1.4" />
                    </svg>
                </button>
                <button class="button button-foreground icon" id="button_git_hub_to_project">
                    <svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-github-icon lucide-github">
                        <path
                            d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
                        <path d="M9 18c-4.51 2-5-2-7-2" />
                    </svg>
                </button>
                <a class="button button-foreground no-auth" href="./sign-up.html">Cadastrar</a>
                <a class="button button-foreground no-auth" href="./sign-in.html">Entrar</a>
                <a id="preview-profile" class="auth" href="./index.html">

                </a>
                <button class="menu" type="button" id="button_open_menu">
                    <span class="line"></span>
                    <span class="line"></span>
                    <span class="line"></span>
                </button>
            </div>
        </nav>


        <div class="anime">
            <div class='details'>
                <div>
                    <h1 class='title' id="h1_anime_title">
                        Boku no Hero Academia
                    </h1>
                    <p id="p_anime_description">
                        The appearance of "quirks," newly discovered super powers, has been steadily increasing over the
                        years, with 80 percent
                        of humanity possessing various abilities from manipulation of elements to shapeshifting. This
                        leaves the remainder of
                        the world completely powerless, and Izuku Midoriya is one such individual.

                        Since he was a child, the ambitious middle schooler has wanted nothing more than to be a hero.
                        Izuku's unfair fate
                        Since he was a child, the ambitious middle schooler has wanted nothing more than to be a hero.
                        Izuku's unfair fate
                        Since he was a child, the ambitious middle schooler has wanted nothing more than to be a hero.
                        Izuku's unfair fate
                        Since he was a child, the ambitious middle schooler has wanted nothing more than to be a hero.
                        Izuku's unfair fate

                    </p>
                </div>
                <div>
                    <h3 class='title'>
                        Personagens
                    </h3>
                    <div class='characters' id="div_characters">
                    </div>
                </div>

            </div>
            <div class='anime-cover'>
                <img src='https://cdn.myanimelist.net/images/anime/1089/121748l.jpg' alt='cover anime'
                    id="img_anime_preview_cover" />
            </div>

            <h3 class='title'>
                Similares
            </h3>
            <div class="posters" id="div_recommendations">

            </div>
        </div>



        <div class="layout">
            <span class="boxes top-left">
                <span class="box box-red-dark"></span>
                <span class="box box-red-light"></span>
                <span class="box box-red-light"></span>
            </span>
            <span class="boxes top-right">
                <span class="box box-purple-dark"></span>
                <span class="box box-purple-light"></span>
                <span class="box box-purple-light"></span>
            </span>
            <span class="boxes bottom-left">
                <span class="box box-purple-dark"></span>
                <span class="box box-purple-light"></span>
                <span class="box box-purple-light"></span>
            </span>
            <span class="boxes bottom-right">
                <span class="box box-red-dark"></span>
                <span class="box box-red-light"></span>
                <span class="box box-red-light"></span>
            </span>
        </div>
    </section>



    <section class="second container">

        <h1 class='title'>
            Comentarios
        </h1>

        <div class="content-comment">
            <div class="comments" id="div_comments">

            </div>
            <div class="create-comment">

                <div class="top">
                    <img src="./assets/uploads/henry-profile.png" id="avatar_profile_url" alt="" class="profile">
                    <h3 id="avatar_profile_username">HENRY FRANZ</h3>
                </div>

                <textarea name="comment-content" id="comment-content" class="content-comment"
                    placeholder="The appearance of " quirks," newly discovered super powers, has been steadily
                    increasing over the years, with 80 percent o"></textarea>
                <div class="buttons-comment">
                    <button onclick="cleanComment()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-trash-icon lucide-trash">
                            <path d="M3 6h18" />
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                        </svg>
                        <span>Limpar</span>
                    </button>

                    <button onclick="registerComment()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-check-icon lucide-check">
                            <path d="M2j0 6 9 17l-5-5" />
                        </svg>
                        <span>Salvar</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="layout">
            <span class="boxes top-left">
                <span class="box box-red-dark"></span>
                <span class="box box-red-light"></span>
                <span class="box box-red-light"></span>
            </span>
            <span class="boxes top-right">
                <span class="box box-purple-dark"></span>
                <span class="box box-purple-light"></span>
                <span class="box box-purple-light"></span>
            </span>
            <span class="boxes bottom-left">
                <span class="box box-purple-dark"></span>
                <span class="box box-purple-light"></span>
                <span class="box box-purple-light"></span>
            </span>
            <span class="boxes bottom-right">
                <span class="box box-red-dark"></span>
                <span class="box box-red-light"></span>
                <span class="box box-red-light"></span>
            </span>
        </div>
    </section>


    <!-- expand -->
    <div class="sheet" id="sheet">
        <span id="button_close_menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-x-icon lucide-x">
                <path d="M18 6 6 18" />
                <path d="m6 6 12 12" />
            </svg>
        </span>
        <div class="links">

            <span class="link">
                <a href="./index.html">Home</a>
            </span>
            <span class="link">
                <a href="./quizzes.html">Quizzes</a>
            </span>
            <span class="link auth">
                <a href="./dashboard.html">Dashboard</a>
            </span>
            <span class="link auth exit" id="button-exit">
                <span href="./index.html">
                    <p>Sair</p>

                    <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-log-out-icon lucide-log-out">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" x2="9" y1="12" y2="12" />
                    </svg>
                </span>
            </span>
        </div>


    </div>

    <script src="./assets/javascript/authenticate.js" type="module" defer></script>
    <script src="./assets/javascript/redirects.js" type="module" defer></script>
    <script src="./assets/javascript/manege-storage-session.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-button-theme.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-toggle-menu.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-in-link-in-sheet.js" type="module" defer></script>
    <script src="./assets/javascript/remove-item-in-page.js" type="module" defer></script>
    <script src="./assets/javascript/set-preview-profile.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-button-exit.js" type="module" defer></script>
    <script src="./assets/javascript/on-load-anime.js" type="module" defer></script>

    <script>
        async function renderComments(animeId) {
            const response = await fetch(`/comments/${animeId}`)
            const data = await response.json()

            const comments = data.comments


            let commentsContent = ''

            for (let position = 0; position < comments.length; position++) {
                let comment = comments[position]

                commentsContent += `
    <div class="comment">
        <img src="./assets/uploads/${comment.avatar_url}"
            alt="" class="profile-comment">
        <div class="details-comment">
            <div class="top">
                <h3>
                  ${comment.username}
                </h3>
                <p>
                    ${comment.time_relative}
                </p>
            </div>
            <p>
                ${comment.description}
            </p>
        </div>
    </div>
    `
            }


            div_comments.innerHTML = commentsContent
        }

        function cleanComment() {
            document.getElementById("comment-content").value = ""
        }

        function registerComment() {
            const url = new URL(window.location.href)
            const animeId = url.searchParams.get("animeId")
            const comment = document.getElementById("comment-content").value
            const userId = sessionStorage.user_id
            if (comment == "") {
                alert("preencha o comentario!!")
                return
            }

            console.log({
                description: comment,
                animeId,
                userId
            })
            fetch("/comments", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    description: comment,
                    animeId,
                    userId
                })
            }).then(response => {
                if (response.ok) {
                    cleanComment()
                    renderComments(animeId)
                } else {
                    alert("deu tudo errado")
                }
            })
        }

    </script>

</body>

</html>