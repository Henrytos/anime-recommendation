<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizzes</title>
    <link rel="stylesheet" href="./assets/styles/quiz.css">
    <link rel="shortcut icon" href="./assets/icons/logo.png" type="image/x-icon">
</head>

<body class="dark">


    <section class="start container background" id="section_container">
        <nav class="nav-bar">
            <a href="./index.html">
                <img src="./assets/images/logo-home.png" alt="logo" id="logo" width="292" height="64">
            </a>
            <div class="buttons">
                <button class="button button-foreground icon" id="button_theme">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-sun-moon-icon lucide-sun-moon">
                        <path d="M12 8a2.83 2.83 0 0 0 4 4 4 4 0 1 1-4-4" />
                        <path d="M12 2v2" />
                        <path d="M12 20v2" />
                        <path d="m4.9 4.9 1.4 1.4" />
                        <path d="m17.7 17.7 1.4 1.4" />
                        <path d="M2 12h2" />
                        <path d="M20 12h2" />
                        <path d="m6.3 17.7-1.4 1.4" />
                        <path d="m19.1 4.9-1.4 1.4" />
                    </svg>
                </button>
                <button class="button button-foreground icon" id="button_git_hub_to_project">
                    <svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-github-icon lucide-github">
                        <path
                            d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
                        <path d="M9 18c-4.51 2-5-2-7-2" />
                    </svg>
                </button>
                <a class="button button-foreground no-auth" href="./sign-up.html">Cadastrar</a>
                <a class="button button-foreground no-auth" href="./sign-in.html">Entrar</a>
                <a id="preview-profile" class="auth" href="./index.html">

                </a>
                <button class="menu" type="button" id="button_open_menu">
                    <span class="line"></span>
                    <span class="line"></span>
                    <span class="line"></span>
                </button>
            </div>
        </nav>

        <div class="content" id="content">
            <h1 id="title-quiz" class="slide-new">

            </h1>


            <img id="image-question-1" src="./assets/images/image-quetion-1.png" alt="imagem da loli da duvida">
            <img id="image-question-2" src="./assets/images/image-quetion-2.png" alt="imagem da loli da duvida 2">

        </div>

        <div class="questions" id="div_questions">

        </div>



        <div class="layout">
            <span class="boxes top-left">
                <span class="box box-red-dark"></span>
                <span class="box box-red-light"></span>
                <span class="box box-red-light"></span>
            </span>
            <span class="boxes top-right">
                <span class="box box-purple-dark"></span>
                <span class="box box-purple-light"></span>
                <span class="box box-purple-light"></span>
            </span>
            <span class="boxes bottom-left">
                <span class="box box-purple-dark"></span>
                <span class="box box-purple-light"></span>
                <span class="box box-purple-light"></span>
            </span>
            <span class="boxes bottom-right">
                <span class="box box-red-dark"></span>
                <span class="box box-red-light"></span>
                <span class="box box-red-light"></span>
            </span>
        </div>
    </section>

    <!-- expand -->

    <div class="sheet" id="sheet">
        <span id="button_close_menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-x-icon lucide-x">
                <path d="M18 6 6 18" />
                <path d="m6 6 12 12" />
            </svg>
        </span>
        <div class="links">

            <span class="link">
                <a href="./index.html">Home</a>
            </span>
            <span class="link">
                <a href="./quizzes.html" class="active">Quizzes</a>
            </span>
            <span class="link auth">
                <a href="./dashboard.html">Dashboard</a>
            </span>
            <span class="link auth exit" id="button-exit">
                <span href="./index.html">
                    <p>Sair</p>

                    <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-log-out-icon lucide-log-out">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" x2="9" y1="12" y2="12" />
                    </svg>
                </span>
            </span>
        </div>


    </div>

    <script src="./assets/javascript/redirects.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-button-theme.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-toggle-menu.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-in-link-in-sheet.js" type="module" defer></script>
    <script src="./assets/javascript/remove-item-in-page.js" type="module" defer></script>
    <script src="./assets/javascript/set-preview-profile.js" type="module" defer></script>
    <script src="./assets/javascript/on-click-button-exit.js" type="module" defer></script>
    <script src="./assets/javascript/on-load-render-quiz.js" type="module" defer></script>

    <script>

        let slide = 1
        let sizeSlide = 0

        const animesMapping = []



        function setSlide(size) {
            sizeSlide = size
        }


        function selectionAlternative(alternativeId, questionId, targetAudience, gender) {
            console.log({
                alternativeId,
                questionId,
                targetAudience,
                gender
            });

            for (let positionAnime = 0; positionAnime < animesMapping.length; positionAnime++) {
                let anime = animesMapping[positionAnime]

                if (anime.target_audience == targetAudience) {
                    animesMapping[positionAnime].points++
                }
                if (anime.gender == gender) {
                    animesMapping[positionAnime].points++
                }
            }



            verifySlideFinished()
        }

        function verifySlideFinished() {
            const questionsSection = document.querySelectorAll(".question");

            if (slide < sizeSlide) {
                let oldSlide = questionsSection[slide - 1]
                let newSlide = questionsSection[slide]
                nextSlide(newSlide, oldSlide)
            } else {


                let oldSlide = questionsSection[slide - 1]
                let newSlide = document.querySelector('.content-final')
                nextSlide(newSlide, oldSlide)

                let bestRecommendedPoints = animesMapping[0].points
                let bestRecommendedPointsAnimeId = animesMapping[0].anime_id

                for (let positionAnime = 0; positionAnime < animesMapping.length; positionAnime++) {
                    const anime = animesMapping[positionAnime];

                    if (anime.points > bestRecommendedPoints) {
                        bestRecommendedPoints = anime.points
                        bestRecommendedPointsAnimeId = anime.anime_id
                    }
                }

                const TIME_TWO_SECONDS = 2000;
                setTimeout(() => {
                    const url = new URL(window.location.href)
                    const quizId = url.searchParams.get("quiz_id")
                    const userId = sessionStorage.getItem("user_id")

                    fetch("/quiz/result", {
                        method: "POST",
                        headers: {
                            "content-type": "application/json",
                        },
                        body: JSON.stringify({ quizId, userId, animeId: bestRecommendedPointsAnimeId }),
                    }).then(() => {
                        window.location.href = `./anime.html?animeId=${bestRecommendedPointsAnimeId}`
                    });

                }, TIME_TWO_SECONDS);
            }
        }

        function nextSlide(newElement, removeElement) {
            removeElement.classList.remove("slide-show");
            removeElement.classList.add("slide-old");

            newElement.classList.remove("slide-new");
            newElement.classList.add("slide-show");

            slide++
        }

    </script>
</body>

</html>